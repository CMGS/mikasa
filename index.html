<html>
<head>
<script>
var ws_w = null;
var ws_r = null;
function connect() {
    if (ws_w == null) {
      ws_w = new WebSocket('ws://127.0.0.1:8060/1/1');
        ws_w.onopen = function () {
              log('writer connected');
        };
        ws_w.onerror = function (error) {
              log(error);
        };
        ws_w.onmessage = function (e) {
              log('  ' + e.data);
        };
        ws_w.onclose = function () {
              log('writer disconnected');
              ws_w = null;
        };
    }
    else log('writer already connected');

    if (ws_r == null) {
      ws_r = new WebSocket('ws://127.0.0.1:8060/1/1/pusher');
        ws_r.onopen = function () {
              log('reader connected');
        };
        ws_r.onerror = function (error) {
              log(error);
        };
        ws_r.onmessage = function (e) {
              log('  ' + e.data);
        };
        ws_r.onclose = function () {
              log('reader disconnected');
              ws_r = null;
        };
    }
    else log('reader already connected');

    return false;
}

function disconnect() {
    if (ws_w != null) ws_w.close(); else log('writer already disconnected');
    if (ws_r != null) ws_r.close(); else log('reader already disconnected');
    return false;
}
function send() {
    if (ws_w === null) return log('please connect first');
      var text = document.getElementById('text').value;
      document.getElementById('text').value = "";
      ws_w.send(text);
      return false;
}
function log(text) {
    var li = document.createElement('li');
    li.appendChild(document.createTextNode(text));
    document.getElementById('log').appendChild(li);
    return false;
}
</script>
</head>
<body>
  <form onsubmit="return send();">
      <button type="button" onclick="return connect();">
          Connect
     </button>
     <button type="button" onclick="return disconnect();">
          Disconnect
     </button>
     <input id="text" type="text">
     <button type="submit">Send</button>
     </form>
     <ol id="log"></ol>
 </body>
</html>

